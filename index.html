<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pancracio Adventure M贸vil</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Press Start 2P', cursive; background: #5c94fc; user-select: none; }
        
        /* Pantalla de Inicio */
        #pantalla-inicio {
            position: fixed; width: 100%; height: 100%; background: black;
            display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10;
        }
        h1 { color: white; font-size: 20px; text-align: center; margin-bottom: 30px; line-height: 1.5; }
        button { 
            padding: 15px 30px; font-family: 'Press Start 2P'; cursor: pointer;
            background: #e7691d; color: white; border: 4px solid #fff;
            touch-action: manipulation; /* Mejora la respuesta t谩ctil */
        }

        /* Escenario */
        #juego { display: none; width: 100vw; height: 100vh; position: relative; overflow: hidden; }
        .pasto { position: absolute; bottom: 0; width: 100%; height: 50px; background: #71aa34; }
        .rio { position: absolute; bottom: 0; left: 300px; width: 150px; height: 30px; background: #4d92d4; }
        
        /* Personaje y Elementos */
        #player { 
            position: absolute; bottom: 50px; left: 50px; width: 40px; height: 40px; 
            background: #ff4500; border: 3px solid black; transition: bottom 0.1s;
        }
        .estrella { 
            position: absolute; width: 25px; height: 25px; background: yellow; 
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }
        .caja { 
            position: absolute; right: 50px; bottom: 50px; width: 60px; height: 60px; 
            background: #8b4513; border: 4px solid #5d2e0d; display: none;
            justify-content: center; align-items: center; color: gold; font-size: 30px;
        }
        #mensaje-final {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: yellow; text-shadow: 4px 4px red; font-size: 30px; text-align: center; z-index: 20;
        }

        /* Controles M贸viles */
        #controles-movil {
            position: fixed; bottom: 20px; left: 0; width: 100%;
            display: flex; justify-content: space-between; padding: 0 20px;
            box-sizing: border-box; z-index: 15;
        }
        .control-btn {
            background: rgba(0, 0, 0, 0.7); color: white; border: 2px solid white;
            padding: 15px 25px; font-size: 18px; font-family: 'Press Start 2P';
            cursor: pointer; border-radius: 5px; touch-action: manipulation;
        }
        #marcador {
            position: fixed; top: 10px; left: 10px; color: white; font-size: 16px;
            background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 5px; z-index: 10;
        }
    </style>
</head>
<body>

    <div id="pantalla-inicio">
        <h1>驴QUIN ERES?</h1>
        <button onclick="iniciarJuego()">INICIAR</button>
    </div>

    <div id="juego">
        <div id="marcador">Estrellas: <span id="contador">0</span>/5</div>
        <div class="rio"></div>
        <div class="pasto"></div>
        <div id="player"></div>
        <div id="caja" class="caja">?</div>
        
        <div id="controles-movil">
            <button class="control-btn" ontouchstart="movePlayer(-1)" ontouchend="stopPlayer()">&#9664; Izq</button>
            <button class="control-btn" ontouchstart="jumpPlayer()">Saltar</button>
            <button class="control-btn" ontouchstart="movePlayer(1)" ontouchend="stopPlayer()">Der &#9654;</button>
        </div>
    </div>

    <div id="mensaje-final">隆ERES UN PANCRACIO, PANCRACIO! </div>

    <script>
        let score = 0;
        const player = document.getElementById('player');
        let playerPosX = 50;
        let playerPosY = 50;
        let jumping = false;
        let movingInterval; // Para el movimiento continuo

        function iniciarJuego() {
            document.getElementById('pantalla-inicio').style.display = 'none';
            document.getElementById('juego').style.display = 'block';
            crearEstrellas();
            actualizar(); // Iniciar el loop de actualizaci贸n
        }

        function crearEstrellas() {
            for(let i=0; i<5; i++) {
                let star = document.createElement('div');
                star.className = 'estrella';
                // Posiciones m谩s dispersas para m贸vil
                star.style.left = (100 + (i * 100) + (Math.random() * 50)) + 'px'; 
                star.style.bottom = (80 + (Math.random() * 100)) + 'px'; // M谩s bajo por los controles
                star.id = 'star-' + i;
                document.getElementById('juego').appendChild(star);
            }
        }

        function movePlayer(direction) { // direction: -1 para izquierda, 1 para derecha
            if (movingInterval) clearInterval(movingInterval); // Detener movimiento anterior
            movingInterval = setInterval(() => {
                playerPosX += (direction * 8); // Velocidad de movimiento
                player.style.left = playerPosX + 'px';
                checkCollisions(); // Chequear colisiones mientras se mueve
            }, 50);
        }

        function stopPlayer() {
            clearInterval(movingInterval);
            movingInterval = null;
        }

        function jumpPlayer() {
            if(!jumping) {
                jumping = true;
                playerPosY += 80; // Altura del salto
                player.style.bottom = playerPosY + 'px';
                setTimeout(() => { 
                    playerPosY -= 80; 
                    player.style.bottom = playerPosY + 'px';
                    jumping = false;
                    checkCollisions(); // Chequear colisiones al aterrizar
                }, 300); // Duraci贸n del salto
            }
        }

        function checkCollisions() {
            // Detectar colisi贸n con estrellas
            document.querySelectorAll('.estrella').forEach(star => {
                if(star && checkCollision(player, star)) { // Verificar si la estrella existe
                    star.remove();
                    score++;
                    document.getElementById('contador').innerText = score;
                    if(score === 5) {
                        document.getElementById('caja').style.display = 'flex';
                        document.getElementById('caja').innerText = "";
                    }
                }
            });

            // Detectar colisi贸n con caja final
            const caja = document.getElementById('caja');
            if(score === 5 && caja.style.display === 'flex' && checkCollision(player, caja)) {
                document.getElementById('mensaje-final').style.display = 'block';
                // Detener el juego al mostrar el mensaje final
                clearInterval(movingInterval);
                movingInterval = null;
            }
        }

        // Esta funci贸n se ejecuta para mantener todo actualizado
        function actualizar() {
            // Aqu铆 puedes a帽adir m谩s l贸gica de juego si quieres animaciones o gravedad
            // Por ahora, las colisiones se checan con el movimiento y el salto.
        }

        function checkCollision(a, b) {
            let aRect = a.getBoundingClientRect();
            let bRect = b.getBoundingClientRect();
            // Aumentar un poco el tama帽o de las colisiones para que sea m谩s f谩cil en m贸vil
            const padding = 5; 
            return !(aRect.right < bRect.left + padding || 
                     aRect.left > bRect.right - padding || 
                     aRect.bottom < bRect.top + padding || 
                     aRect.top > bRect.bottom - padding);
        }
    </script>
</body>
</html>
